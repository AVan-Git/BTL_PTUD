/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package GUI;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.List;

import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JSpinner;
import javax.swing.SpinnerNumberModel;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.table.DefaultTableModel;
import javax.swing.text.JTextComponent;

import dao.CT_HoaDonDAO;
import dao.HoaDonDAO;
import dao.KhachHangDAO;
import dao.NhanvienDAO;
import dao.SachDAO;
import dao.impl.CT_HoaDonImpl;
import dao.impl.HoaDonImpl;
import dao.impl.KhachHangImpl;
import dao.impl.NhanvienImpl;
import dao.impl.SachImpl;
import entity.CT_HoaDon;
import entity.DonDat;
import entity.HoaDon;
import entity.KhachHang;
import entity.NhaXuatBan;
import entity.NhanVien;
import entity.Sach;
import entity.TacGia;

/**
 *
 * @author LENOVO
 */
public class LapHD extends JFrame implements ActionListener, MouseListener, ChangeListener {

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton X;
	private javax.swing.JButton btnRefreshKH;
	private javax.swing.JButton btnXoaHD;
	private javax.swing.JButton btnHuy;
	private javax.swing.JButton btnRefreshSach;
	private javax.swing.JButton btnThemKH;
	private javax.swing.JButton btnThanhToan;
	private javax.swing.JButton btnThemSach;
	private javax.swing.JButton btnTimKH;
	private javax.swing.JButton btnTimSach;
	private javax.swing.JComboBox<String> cbbNhaXB;
	private javax.swing.JComboBox<String> cbbTacGia;
	private javax.swing.JComboBox<String> cbbTheloai;
	private javax.swing.JLabel jLabel1;
	private javax.swing.JLabel jLabel10;
	private javax.swing.JLabel jLabel11;
	private javax.swing.JLabel jLabel12;
	private javax.swing.JLabel jLabel13;
	private javax.swing.JLabel jLabel14;
	private javax.swing.JLabel jLabel17;
	private javax.swing.JLabel jLabel2;
	private javax.swing.JLabel jLabel3;
	private javax.swing.JLabel jLabel4;
	private javax.swing.JLabel jLabel5;
	private javax.swing.JLabel jLabel6;
	private javax.swing.JLabel jLabel7;
	private javax.swing.JLabel jLabel8;
	private javax.swing.JLabel jLabel9;
	private javax.swing.JPanel jPanel2;
	private javax.swing.JScrollPane jScrollPane1;
	private javax.swing.JScrollPane jScrollPane2;
	private javax.swing.JSeparator jSeparator1;
	private javax.swing.JSeparator jSeparator2;
	private javax.swing.JSeparator jSeparator3;
	private javax.swing.JSeparator jSeparator4;
	private javax.swing.JSeparator jSeparator5;
	private javax.swing.JTextField txtTongTien;
	private javax.swing.JTextField txtSoDT;
	private javax.swing.JTextField txtTenKH;
	private javax.swing.JTextField txtTenNV;
	private javax.swing.JSpinner spnSoLuong;
	private javax.swing.JTable tableDonDat;
	private DefaultTableModel modelDonDat;
	private javax.swing.JTable tableSach;
	private DefaultTableModel modelSach;
	private javax.swing.JTextField txtMaSach;
	private javax.swing.JTextField txtTenSach;
	private String tk = QL.taiKhoan;

	private SpinnerNumberModel spinnerModel;
	private int soLuong = 0;

	private List<CT_HoaDon> dsCt_HoaDon = new ArrayList<>();

	SachDAO sachDAO = new SachImpl();
	KhachHangDAO khachHangDAO = new KhachHangImpl();
	HoaDonDAO hoaDonDAO = new HoaDonImpl();
	CT_HoaDonDAO ct_HoaDonDAO = new CT_HoaDonImpl();
	NhanvienDAO nhanvienDAO = new NhanvienImpl();

	private DecimalFormat dformat = new DecimalFormat("###,###,###.00 VND");

	/**
	 * Creates new form LapHD
	 */
	public LapHD() {
		initComponents();
		String b = QLKH_LapHD.dataTen;
		String c = QLKH_LapHD.dataSoDT;

		if (b != null) {
			txtTenKH.setText(b);
			txtSoDT.setText(c);
		}
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed" desc="Generated
	// Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		jPanel2 = new javax.swing.JPanel();
		jLabel2 = new javax.swing.JLabel();
		jLabel3 = new javax.swing.JLabel();
		txtMaSach = new javax.swing.JTextField();
		jLabel4 = new javax.swing.JLabel();
		txtTenSach = new javax.swing.JTextField();
		jLabel1 = new javax.swing.JLabel();
		jSeparator1 = new javax.swing.JSeparator();
		jSeparator2 = new javax.swing.JSeparator();
		jLabel6 = new javax.swing.JLabel();
		cbbTheloai = new javax.swing.JComboBox<>();
		jLabel7 = new javax.swing.JLabel();
		cbbTacGia = new javax.swing.JComboBox<>();
		jLabel8 = new javax.swing.JLabel();
		cbbNhaXB = new javax.swing.JComboBox<>();
		jScrollPane1 = new javax.swing.JScrollPane();
		tableSach = new javax.swing.JTable();
		jScrollPane2 = new javax.swing.JScrollPane();
		tableDonDat = new javax.swing.JTable();
		jSeparator3 = new javax.swing.JSeparator();
		jLabel9 = new javax.swing.JLabel();
		btnThemSach = new javax.swing.JButton();
		btnRefreshSach = new javax.swing.JButton();
		spnSoLuong = new javax.swing.JSpinner();
		jLabel5 = new javax.swing.JLabel();
		jLabel10 = new javax.swing.JLabel();
		txtTongTien = new javax.swing.JTextField();
		jLabel12 = new javax.swing.JLabel();
		txtTenKH = new javax.swing.JTextField();
		jLabel13 = new javax.swing.JLabel();
		txtSoDT = new javax.swing.JTextField();
		btnRefreshKH = new javax.swing.JButton();
		btnThanhToan = new javax.swing.JButton();
		jLabel14 = new javax.swing.JLabel();
		X = new javax.swing.JButton();
		jSeparator4 = new javax.swing.JSeparator();
		txtTenNV = new javax.swing.JTextField();
		jLabel17 = new javax.swing.JLabel();
		btnTimKH = new javax.swing.JButton();
		btnTimSach = new javax.swing.JButton();
		btnXoaHD = new javax.swing.JButton();
		btnHuy = new javax.swing.JButton();
		jSeparator5 = new javax.swing.JSeparator();
		jLabel11 = new javax.swing.JLabel();
		btnThemKH = new javax.swing.JButton();

		setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
		setUndecorated(true);
		jPanel2.setBackground(new java.awt.Color(204, 204, 204));
		jPanel2.setPreferredSize(new java.awt.Dimension(1361, 767));


		
		/*jPanel2.setBackground(new java.awt.Color(204, 204, 204));
		jPanel2.setPreferredSize(new java.awt.Dimension(1361, 767));*/
		
		jLabel2.setFont(new java.awt.Font("Tahoma", 1, 24)); // NOI18N
		jLabel2.setText("Lập Hóa Đơn");

		jLabel3.setBackground(new java.awt.Color(255, 255, 255));
		jLabel3.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel3.setForeground(new java.awt.Color(255, 51, 0));
		jLabel3.setText("Mã sách");

		jLabel4.setBackground(new java.awt.Color(255, 255, 255));
		jLabel4.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel4.setForeground(new java.awt.Color(255, 51, 0));
		jLabel4.setText("Tên sách");

		jLabel1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
		jLabel1.setText("Tìm kiếm sách");

		jLabel6.setBackground(new java.awt.Color(255, 255, 255));
		jLabel6.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel6.setForeground(new java.awt.Color(255, 51, 0));
		jLabel6.setText("Thể loại");

		cbbTheloai.setModel(new javax.swing.DefaultComboBoxModel<>(
				new String[] { "", "Sách Chính trị – pháp luật", "Sách Khoa học công nghệ", "Sách Kinh tế",
						"Sách Văn học nghệ thuật", "Sách Văn hóa xã hội – Lịch sử", "Sách Giáo trình",
						"Sách Truyện, tiểu thuyết", "Sách Tâm lý", "Sách tôn giáo", "Sách Sách thiếu nhi" }));

		jLabel7.setBackground(new java.awt.Color(255, 255, 255));
		jLabel7.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel7.setForeground(new java.awt.Color(255, 51, 0));
		jLabel7.setText("Tác giả");

		cbbTacGia.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "" }));

		jLabel8.setBackground(new java.awt.Color(255, 255, 255));
		jLabel8.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel8.setForeground(new java.awt.Color(255, 51, 0));
		jLabel8.setText("Nhà xuất bản");

		cbbNhaXB.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "" }));

		tableSach.setModel(new javax.swing.table.DefaultTableModel(new Object[][] {

		}, new String[] { "Mã sách", "Tên sách", "Thể loại", "Tác giả", "Nhà xuất bản", "Giá bán ", "Số lượng" }));
		jScrollPane1.setViewportView(tableSach);

		tableDonDat.setModel(new javax.swing.table.DefaultTableModel(new Object[][] {

		}, new String[] { "Mã sách", "Tên sách", "Số lượng", "Giá thành", "Tổng tiền" }));
		jScrollPane2.setViewportView(tableDonDat);

		jLabel9.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
		jLabel9.setText("Đơn đặt");

		btnThemSach.setBackground(new java.awt.Color(255, 102, 0));
		btnThemSach.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnThemSach.setText("Thêm");

		btnRefreshSach.setBackground(new java.awt.Color(255, 102, 0));
		btnRefreshSach.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnRefreshSach.setText("Làm mới");

		spinnerModel = new SpinnerNumberModel(0, // value
				0, 1000, 1);
		spnSoLuong = new JSpinner(spinnerModel);
		spnSoLuong.setRequestFocusEnabled(false);

		jLabel5.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
		jLabel5.setText("Số lượng");

		jLabel10.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		jLabel10.setForeground(new java.awt.Color(255, 102, 0));
		jLabel10.setText("Tổng tiền: ");

		jLabel12.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		jLabel12.setForeground(new java.awt.Color(255, 102, 0));
		jLabel12.setText("Họ tên khách hàng");

		jLabel13.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		jLabel13.setForeground(new java.awt.Color(255, 102, 0));
		jLabel13.setText("Số Điện Thoại");

		btnRefreshKH.setBackground(new java.awt.Color(255, 102, 0));
		btnRefreshKH.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnRefreshKH.setText("Làm mới");

		btnThanhToan.setBackground(new java.awt.Color(255, 102, 0));
		btnThanhToan.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnThanhToan.setText("Thanh Toán");

		jLabel14.setFont(new java.awt.Font("Tahoma", 1, 16)); // NOI18N
		jLabel14.setText("Thông tin hóa đơn");

		X.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
		X.setForeground(new java.awt.Color(255, 0, 0));
		X.setText("X");
		X.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				XActionPerformed(evt);
			}
		});

		jSeparator4.setOrientation(javax.swing.SwingConstants.VERTICAL);

		jLabel17.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		jLabel17.setForeground(new java.awt.Color(255, 102, 0));
		jLabel17.setText("Họ tên nhân viên");

		btnTimKH.setBackground(new java.awt.Color(255, 102, 0));
		btnTimKH.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnTimKH.setText("Tìm kiếm");

		btnTimSach.setBackground(new java.awt.Color(255, 102, 0));
		btnTimSach.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnTimSach.setText("Tìm kiếm");

		btnXoaHD.setBackground(new java.awt.Color(255, 102, 0));
		btnXoaHD.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnXoaHD.setText("Xóa");

		btnHuy.setBackground(new java.awt.Color(255, 102, 0));
		btnHuy.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnHuy.setText("Hủy");

		jSeparator5.setOrientation(javax.swing.SwingConstants.VERTICAL);

		jLabel11.setFont(new java.awt.Font("Tahoma", 1, 16)); // NOI18N
		jLabel11.setText("VND");

		btnThemKH.setBackground(new java.awt.Color(255, 255, 255));
		btnThemKH.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnThemKH.setIcon(new javax.swing.ImageIcon(getClass().getResource("/image/themKH.jpg"))); // NOI18N
		btnThemKH.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				btnThemKHActionPerformed(evt);
			}
		});

		javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
		jPanel2.setLayout(jPanel2Layout);
		jPanel2Layout.setHorizontalGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(jPanel2Layout.createSequentialGroup().addContainerGap().addGroup(jPanel2Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(jPanel2Layout.createSequentialGroup()
								.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
										.addComponent(jLabel9)
										.addGroup(jPanel2Layout.createSequentialGroup().addGap(10, 10, 10).addComponent(
												jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 650,
												javax.swing.GroupLayout.PREFERRED_SIZE))
										.addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, 672,
												javax.swing.GroupLayout.PREFERRED_SIZE))
								.addGap(18, 18, 18))
						.addGroup(javax.swing.GroupLayout.Alignment.TRAILING,
								jPanel2Layout.createSequentialGroup().addComponent(jLabel5).addGap(18, 18, 18)
										.addComponent(spnSoLuong, javax.swing.GroupLayout.PREFERRED_SIZE, 58,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addGap(57, 57, 57).addComponent(btnRefreshSach).addGap(69, 69, 69)
										.addComponent(btnThemSach).addGap(139, 139, 139)))
						.addComponent(jSeparator5, javax.swing.GroupLayout.PREFERRED_SIZE, 11,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(
								jPanel2Layout.createSequentialGroup().addGap(27, 27, 27).addGroup(jPanel2Layout
										.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
										.addGroup(jPanel2Layout.createSequentialGroup().addComponent(txtSoDT)
												.addGap(18, 18, 18).addComponent(btnTimKH).addGap(17, 17, 17))
										.addGroup(jPanel2Layout.createSequentialGroup().addGroup(jPanel2Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
												.addGroup(jPanel2Layout.createSequentialGroup()
														.addComponent(btnXoaHD, javax.swing.GroupLayout.PREFERRED_SIZE,
																108, javax.swing.GroupLayout.PREFERRED_SIZE)
														.addGap(36, 36, 36).addComponent(btnRefreshKH,
																javax.swing.GroupLayout.PREFERRED_SIZE, 105,
																javax.swing.GroupLayout.PREFERRED_SIZE))
												.addComponent(jLabel12)
												.addGroup(jPanel2Layout.createSequentialGroup().addGroup(jPanel2Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
														.addGroup(jPanel2Layout.createSequentialGroup()
																.addComponent(jLabel13).addGap(0, 0, Short.MAX_VALUE))
														.addComponent(txtTenKH)).addGap(18, 18, 18)
														.addComponent(btnThemKH, javax.swing.GroupLayout.PREFERRED_SIZE,
																46, javax.swing.GroupLayout.PREFERRED_SIZE)))
												.addGap(16, 16, 16)))
										.addGroup(jPanel2Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
												.addGroup(jPanel2Layout.createSequentialGroup()
														.addComponent(btnHuy, javax.swing.GroupLayout.PREFERRED_SIZE,
																102, javax.swing.GroupLayout.PREFERRED_SIZE)
														.addGap(33, 33, 33).addComponent(btnThanhToan)
														.addContainerGap())
												.addGroup(jPanel2Layout.createSequentialGroup().addGap(2, 2, 2)
														.addComponent(jSeparator4,
																javax.swing.GroupLayout.PREFERRED_SIZE,
																javax.swing.GroupLayout.DEFAULT_SIZE,
																javax.swing.GroupLayout.PREFERRED_SIZE)
														.addGap(18, 18, 18)
														.addGroup(jPanel2Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.LEADING)
																.addGroup(jPanel2Layout.createSequentialGroup()
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																				.addComponent(txtTenNV,
																						javax.swing.GroupLayout.PREFERRED_SIZE,
																						224,
																						javax.swing.GroupLayout.PREFERRED_SIZE)
																				.addComponent(jLabel17))
																		.addGap(0, 0, Short.MAX_VALUE))
																.addGroup(jPanel2Layout.createSequentialGroup()
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																				.addGroup(jPanel2Layout
																						.createSequentialGroup()
																						.addComponent(txtTongTien,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								145,
																								javax.swing.GroupLayout.PREFERRED_SIZE)
																						.addPreferredGap(
																								javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																						.addComponent(jLabel11))
																				.addComponent(jLabel10))
																		.addContainerGap(
																				javax.swing.GroupLayout.DEFAULT_SIZE,
																				Short.MAX_VALUE))))))
								.addGroup(javax.swing.GroupLayout.Alignment.TRAILING,
										jPanel2Layout.createSequentialGroup()
												.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED,
														javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
												.addComponent(jLabel14).addGap(205, 205, 205))))
				.addGroup(jPanel2Layout.createSequentialGroup().addGap(60, 60, 60)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addComponent(txtMaSach, javax.swing.GroupLayout.PREFERRED_SIZE, 140,
										javax.swing.GroupLayout.PREFERRED_SIZE)
								.addComponent(jLabel3))
						.addGap(105, 105, 105)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addGroup(jPanel2Layout.createSequentialGroup().addComponent(jLabel4)
										.addGap(141, 141, 141).addComponent(jLabel6))
								.addGroup(jPanel2Layout.createSequentialGroup()
										.addComponent(txtTenSach, javax.swing.GroupLayout.PREFERRED_SIZE, 140,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addGap(54, 54, 54).addComponent(cbbTheloai,
												javax.swing.GroupLayout.PREFERRED_SIZE, 144,
												javax.swing.GroupLayout.PREFERRED_SIZE)))
						.addGap(56, 56, 56)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addComponent(jLabel7).addComponent(cbbTacGia, javax.swing.GroupLayout.PREFERRED_SIZE,
										javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
						.addGap(63, 63, 63)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addComponent(jLabel8).addComponent(cbbNhaXB, javax.swing.GroupLayout.PREFERRED_SIZE,
										144, javax.swing.GroupLayout.PREFERRED_SIZE))
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED,
								javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
						.addComponent(btnTimSach).addGap(122, 122, 122))
				.addGroup(javax.swing.GroupLayout.Alignment.TRAILING,
						jPanel2Layout.createSequentialGroup().addContainerGap().addComponent(jSeparator1)
								.addContainerGap())
				.addGroup(jPanel2Layout.createSequentialGroup().addContainerGap()
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addComponent(jSeparator2)
								.addGroup(jPanel2Layout.createSequentialGroup().addGap(0, 0, Short.MAX_VALUE)
										.addComponent(jLabel2).addGap(487, 487, 487).addComponent(X).addGap(74, 74, 74))
								.addGroup(jPanel2Layout.createSequentialGroup().addGap(67, 67, 67).addComponent(jLabel1)
										.addGap(0, 0, Short.MAX_VALUE)))
						.addContainerGap())
				.addGroup(jPanel2Layout
						.createSequentialGroup().addGap(20, 20, 20).addComponent(jScrollPane1,
								javax.swing.GroupLayout.PREFERRED_SIZE, 1274, javax.swing.GroupLayout.PREFERRED_SIZE)
						.addContainerGap(28, Short.MAX_VALUE)));
		jPanel2Layout.setVerticalGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(jPanel2Layout.createSequentialGroup().addGap(13, 13, 13)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
								.addComponent(jLabel2).addComponent(X))
						.addGap(4, 4, 4).addComponent(jLabel1)
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
								.addGroup(jPanel2Layout.createSequentialGroup()
										.addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addGroup(jPanel2Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
												.addGroup(jPanel2Layout.createSequentialGroup().addGroup(jPanel2Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(jLabel4).addComponent(jLabel6)
														.addComponent(jLabel3))
														.addPreferredGap(
																javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
														.addGroup(jPanel2Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.BASELINE)
																.addComponent(txtTenSach,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addComponent(txtMaSach,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE)))
												.addGroup(jPanel2Layout.createSequentialGroup().addComponent(jLabel8)
														.addPreferredGap(
																javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
														.addComponent(cbbNhaXB, javax.swing.GroupLayout.PREFERRED_SIZE,
																javax.swing.GroupLayout.DEFAULT_SIZE,
																javax.swing.GroupLayout.PREFERRED_SIZE))
												.addGroup(jPanel2Layout.createSequentialGroup().addComponent(jLabel7)
														.addPreferredGap(
																javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
														.addGroup(jPanel2Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.BASELINE)
																.addComponent(cbbTacGia,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addComponent(cbbTheloai,
																		javax.swing.GroupLayout.PREFERRED_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.PREFERRED_SIZE)))))
								.addComponent(btnTimSach, javax.swing.GroupLayout.PREFERRED_SIZE, 38,
										javax.swing.GroupLayout.PREFERRED_SIZE))
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
						.addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 11,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(4, 4, 4)
						.addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 247,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addGroup(jPanel2Layout.createSequentialGroup().addGap(20, 20, 20)
										.addGroup(jPanel2Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jLabel5)
												.addComponent(spnSoLuong, javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addComponent(btnRefreshSach).addComponent(btnThemSach))
										.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addComponent(jLabel9)
										.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, 13,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 246,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addGap(0, 0, Short.MAX_VALUE))
								.addGroup(jPanel2Layout.createSequentialGroup().addGap(18, 18, 18)
										.addGroup(jPanel2Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
												.addComponent(jSeparator5, javax.swing.GroupLayout.PREFERRED_SIZE, 332,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addGroup(jPanel2Layout.createSequentialGroup()
														.addComponent(jLabel14, javax.swing.GroupLayout.PREFERRED_SIZE,
																51, javax.swing.GroupLayout.PREFERRED_SIZE)
														.addGroup(jPanel2Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.TRAILING)
																.addGroup(jPanel2Layout.createSequentialGroup()
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.TRAILING,
																				false)
																				.addGroup(jPanel2Layout
																						.createSequentialGroup()
																						.addGap(25, 25, 25)
																						.addComponent(jLabel13)
																						.addPreferredGap(
																								javax.swing.LayoutStyle.ComponentPlacement.RELATED))
																				.addGroup(
																						javax.swing.GroupLayout.Alignment.LEADING,
																						jPanel2Layout
																								.createSequentialGroup()
																								.addGap(26, 26, 26)
																								.addComponent(jLabel17)
																								.addPreferredGap(
																										javax.swing.LayoutStyle.ComponentPlacement.RELATED,
																										javax.swing.GroupLayout.DEFAULT_SIZE,
																										Short.MAX_VALUE)))
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																				.addGroup(jPanel2Layout
																						.createParallelGroup(
																								javax.swing.GroupLayout.Alignment.BASELINE)
																						.addComponent(txtSoDT,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								32,
																								javax.swing.GroupLayout.PREFERRED_SIZE)
																						.addComponent(btnTimKH,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								35,
																								javax.swing.GroupLayout.PREFERRED_SIZE))
																				.addComponent(txtTenNV,
																						javax.swing.GroupLayout.PREFERRED_SIZE,
																						32,
																						javax.swing.GroupLayout.PREFERRED_SIZE))
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																				.addGroup(jPanel2Layout
																						.createSequentialGroup()
																						.addGap(30, 30, 30)
																						.addComponent(jLabel12))
																				.addGroup(
																						javax.swing.GroupLayout.Alignment.TRAILING,
																						jPanel2Layout
																								.createSequentialGroup()
																								.addPreferredGap(
																										javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																								.addComponent(
																										jLabel10)))
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addGroup(jPanel2Layout.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																				.addGroup(jPanel2Layout
																						.createParallelGroup(
																								javax.swing.GroupLayout.Alignment.BASELINE)
																						.addComponent(txtTenKH,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								32,
																								javax.swing.GroupLayout.PREFERRED_SIZE)
																						.addComponent(txtTongTien,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								32,
																								javax.swing.GroupLayout.PREFERRED_SIZE)
																						.addComponent(jLabel11,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								32,
																								javax.swing.GroupLayout.PREFERRED_SIZE))
																				.addComponent(btnThemKH,
																						javax.swing.GroupLayout.PREFERRED_SIZE,
																						34,
																						javax.swing.GroupLayout.PREFERRED_SIZE)))
																.addGroup(jPanel2Layout.createSequentialGroup()
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(jSeparator4,
																				javax.swing.GroupLayout.PREFERRED_SIZE,
																				144,
																				javax.swing.GroupLayout.PREFERRED_SIZE)))
														.addPreferredGap(
																javax.swing.LayoutStyle.ComponentPlacement.RELATED,
																javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
														.addGroup(jPanel2Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.BASELINE)
																.addComponent(btnXoaHD,
																		javax.swing.GroupLayout.PREFERRED_SIZE, 34,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addComponent(btnRefreshKH,
																		javax.swing.GroupLayout.PREFERRED_SIZE, 34,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addComponent(btnHuy,
																		javax.swing.GroupLayout.PREFERRED_SIZE, 34,
																		javax.swing.GroupLayout.PREFERRED_SIZE)
																.addComponent(btnThanhToan,
																		javax.swing.GroupLayout.PREFERRED_SIZE, 32,
																		javax.swing.GroupLayout.PREFERRED_SIZE))
														.addGap(9, 9, 9)))))
						.addContainerGap()));

		jSeparator4.getAccessibleContext().setAccessibleParent(this);

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
		getContentPane().setLayout(layout);
		layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(
				javax.swing.GroupLayout.Alignment.TRAILING,
				layout.createSequentialGroup().addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
						.addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE,
								javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(1, 1, 1)));
		layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(layout.createSequentialGroup()
						.addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE,
								javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(0, 0, Short.MAX_VALUE)));

		pack();
		setLocationRelativeTo(null);

//      
		this.setExtendedState(JFrame.MAXIMIZED_BOTH); 
		txtTongTien.setEditable(false);
		if (tk == null) {
			System.out.println("hãy chạy từ đăng nhập");
		}
		NhanVien nv = nhanvienDAO.getNhanVien_TaiKhoan(tk);
//		NV00001 
		String tennv = nv.getMaNV().substring(2, 7) + " " + nv.getTenNV();
		txtTenNV.setText(tennv);
		txtTenNV.setEditable(false);
//13
		btnHuy.addActionListener(this);
		btnRefreshKH.addActionListener(this);
		btnRefreshSach.addActionListener(this);
		btnThanhToan.addActionListener(this);
		btnThemSach.addActionListener(this);
		btnTimKH.addActionListener(this);
		btnTimSach.addActionListener(this);
		btnXoaHD.addActionListener(this);
		txtMaSach.addActionListener(this);
		txtSoDT.addActionListener(this);
		txtTenSach.addActionListener(this);

		tableDonDat.addMouseListener(this);
		tableSach.addMouseListener(this);

		cbbNhaXB.addActionListener(this);
		cbbTacGia.addActionListener(this);
		cbbTheloai.addActionListener(this);

		spnSoLuong.addChangeListener(this);
//      
		modelDonDat = (DefaultTableModel) tableDonDat.getModel();

		modelSach = (DefaultTableModel) tableSach.getModel();
		addTable_Sql(sachDAO.getDsSach());
//    
		addCbb_Sql();

		tableDonDat.setDefaultEditor(Object.class, null);

		tableSach.setDefaultEditor(Object.class, null);

	}// </editor-fold>//GEN-END:initComponents

	private void XActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_XActionPerformed
		// TODO add your handling code here:
		new QL(tk).setVisible(true);
		this.setVisible(false);
	}// GEN-LAST:event_XActionPerformed

	private void btnThemKHActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_btnThemKHActionPerformed
		// TODO add your handling code here:
		new QLKH_LapHD().setVisible(true);
		this.setVisible(false);
	}// GEN-LAST:event_btnThemKHActionPerformed

	/**
	 * @param args the command line arguments
	 */
	public static void main(String args[]) {
		/* Set the Nimbus look and feel */
		// <editor-fold defaultstate="collapsed" desc=" Look and feel setting code
		// (optional) ">
		/*
		 * If Nimbus (introduced in Java SE 6) is not available, stay with the default
		 * look and feel. For details see
		 * http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
		 */
		try {
			for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
				if ("Nimbus".equals(info.getName())) {
					javax.swing.UIManager.setLookAndFeel(info.getClassName());
					break;
				}
			}
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(LapHD.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (InstantiationException ex) {
			java.util.logging.Logger.getLogger(LapHD.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(LapHD.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (javax.swing.UnsupportedLookAndFeelException ex) {
			java.util.logging.Logger.getLogger(LapHD.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		}
		// </editor-fold>

		/* Create and display the form */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				new LapHD().setVisible(true);
			}
		});
	}

	@Override
	public void stateChanged(ChangeEvent e) {
		Object o = e.getSource();
		if (o.equals(spnSoLuong)) {
			String a = spnSoLuong.getValue().toString();
			soLuong = Integer.parseInt(a);
//			System.out.println(a + " - " + soLuong);
		}

	}

	@Override
	public void mouseClicked(MouseEvent arg0) {

	}

	@Override
	public void mouseEntered(MouseEvent arg0) {
		// TODO Auto-generated method stub

	}

	@Override
	public void mouseExited(MouseEvent arg0) {
		// TODO Auto-generated method stub

	}

	@Override
	public void mousePressed(MouseEvent arg0) {
		// TODO Auto-generated method stub

	}

	@Override
	public void mouseReleased(MouseEvent arg0) {
		// TODO Auto-generated method stub

	}

	@Override
	public void actionPerformed(ActionEvent e) {
		Object o = e.getSource();
		if (o.equals(btnRefreshSach)) {
			System.err.println("btnRefreshSach");
			xoaRongJtext_Sach();
		} else if (o.equals(txtMaSach) || o.equals(txtTenSach) || o.equals(btnTimSach)) {
			System.err.println("btnTimSach");
			getTimKiemSach();
		} else if (o.equals(btnThemSach)) {
			System.err.println("btnThemSach");
			getThemSach_HoaDon();
		} else if (o.equals(btnXoaHD)) {
			System.err.println("btnXoaHD");
			getXoaHoaDon_Table();
		} else if (o.equals(btnRefreshKH)) {
			System.err.println("btnRefreshKH");
			txtTenKH.setText("");
			txtSoDT.setText("");
			txtSoDT.requestFocus();
		} else if (o.equals(btnTimKH)) {
			System.err.println("btnTimKH");
			KhachHang a = getTimKhachHang_SoDT();

			if (a != null) {

				txtTenKH.setText(a.getTenKH());
			}
		} else if (o.equals(btnHuy)) {
			System.err.println("btnHuy");
			if (JOptionPane.showConfirmDialog(this, "Bạn có chắc chắn muốn hủy toàn bộ hóa đơn hiện tại.", "Cảnh báo.",
					JOptionPane.YES_NO_OPTION) == JOptionPane.YES_NO_OPTION) {

				xoaRongJtext_Sach();
				//
				dsCt_HoaDon = new ArrayList<>();
				addTable_HoaDon(dsCt_HoaDon);

				//
				txtTenKH.setText("");
				txtSoDT.setText("");
				txtSoDT.requestFocus();

			}
		} else if (o.equals(btnThanhToan)) {
			System.err.println("getThanhToan()");
			getThanhToan();
		}

	}

	private void getThanhToan() {
		if (dsCt_HoaDon.size() == 0) {
			JOptionPane.showMessageDialog(this, "Hãy thêm sách vào hóa đơn. \nPlease.");
			return;
		}
		KhachHang kh = getTimKhachHang_SoDT();
		if (kh == null) {
			return;
		}

		if (!setThanhToan()) {
			return;
		}

		String tenNV = txtTenNV.getText().trim();
		String maNV = "NV" + tenNV.substring(0, 5);

		Date ngayLap = getNgayLap();
		double tongTien = Double.parseDouble(txtTongTien.getText());
		NhanVien nv = new NhanVien(maNV);
		DonDat dd = null;

		HoaDon hd = new HoaDon(phatSinh_maHD(), ngayLap, tongTien, nv, kh, dd);

		hoaDonDAO.themHoaDon(hd);

		for (CT_HoaDon a : dsCt_HoaDon) {
			ct_HoaDonDAO.themCT_HoaDon(a);

			Sach sach = sachDAO.getSach_id(a.getSach().getMaSach());
			int x = sach.getSoLuong() - a.getSoluong();
			sach.setSoLuong(x);
			sachDAO.suaSach(sach);
		}

		xoaRongJtext_Sach();
		txtTenKH.setText("");
		txtSoDT.setText("");

		dsCt_HoaDon = new ArrayList<>();
		addTable_HoaDon(dsCt_HoaDon);

		JOptionPane.showMessageDialog(this, "Thanh Toán thành công.\n Hẹn gặp lại.");

	}

	private boolean setThanhToan() {
		double tongTien = Double.parseDouble(txtTongTien.getText().trim());
		String tien = JOptionPane.showInputDialog("Hãy nhập số tiền khách hàng gửi.");
		if (tien == null) {
			JOptionPane.showMessageDialog(this, "Thanh toán hóa đơn không thành công.");
			return false;
		}
		double x = 0.0;
		try {
			x = Double.parseDouble(tien);
		} catch (Exception e) {
			JOptionPane.showMessageDialog(this, "Hãy nhập bằng ký tự số");
			return false;
		}

		if (x < tongTien) {
			JOptionPane.showMessageDialog(this, "Thanh toán hóa đơn không thành công. \nSố tiền chưa đủ.");
			return false;
		}
		JOptionPane.showMessageDialog(this, "Số tiền dư là: " + dformat.format(x - tongTien));
		return true;

	}

	private Date getNgayLap() {
		GregorianCalendar gcalendar = new GregorianCalendar();

		int dd = gcalendar.get(Calendar.DATE);
		int mm = gcalendar.get(Calendar.MONTH);
		int yy = gcalendar.get(Calendar.YEAR);
		Date a = new Date(yy - 1900, mm, dd);
		return a;
	}

	//
	private KhachHang getTimKhachHang_SoDT() {
		String soDT = txtSoDT.getText().trim();
		if (soDT.length() != 10) {
			JOptionPane.showMessageDialog(this,
					"Nhâp số điện thoại cần tìm.\nSố điện thoại phải đủ 10 ký tự số, bắt đầu bằng số 0. \nPlease");
			txtSoDT.requestFocus();
			return null;
		} else {
			KhachHang a = khachHangDAO.getKhachHang_SoDT(soDT);
			if (a == null) {
				JOptionPane.showMessageDialog(this,
						"không tìm thấy khách hàng nào có số điện thoại là: " + txtSoDT.getText());
				return null;
			} else
				return a;
		}

	}

//	
//

	private void getXoaHoaDon_Table() {
		int row = tableDonDat.getSelectedRow();
		if (row >= 0) {

			String maSach = modelDonDat.getValueAt(row, 0).toString();
			String tenSach = modelDonDat.getValueAt(row, 1).toString();
			if (JOptionPane.showConfirmDialog(this,
					"Bạn có muốn xóa quyển sách có mã:' " + maSach + " ' có tên là:' " + tenSach + " '" + " không?",
					"Cảnh báo.", JOptionPane.YES_NO_OPTION) == JOptionPane.YES_NO_OPTION) {
				CT_HoaDon ct_HoaDon = new CT_HoaDon();
				for (int i = 0; i < dsCt_HoaDon.size(); i++) {
					ct_HoaDon = dsCt_HoaDon.get(i);
					if (ct_HoaDon.getSach().getMaSach().equals(maSach)) {
						dsCt_HoaDon.remove(ct_HoaDon);
					}

				}
				addTable_HoaDon(dsCt_HoaDon);
				tableDonDat.setSelectionMode(0);
			}
		} else {
			JOptionPane.showMessageDialog(this, "Hãy chọn quyển sách mà bạn muốn xóa trong bảng hóa đơn. \nPlease.");
		}
	}

	//
	private void getThemSach_HoaDon() {
		int row = tableSach.getSelectedRow();
		if (row >= 0) {
			String soLuongTable = modelSach.getValueAt(row, 6).toString();
			if (check_SoLuong(soLuongTable)) {
				String ma = modelSach.getValueAt(row, 0).toString();
				String ten = modelSach.getValueAt(row, 1).toString();
				String gia = modelSach.getValueAt(row, 5).toString();
				double giaBan = Double.parseDouble(gia);

				CT_HoaDon CThd = new CT_HoaDon(new HoaDon(phatSinh_maHD()), new Sach(ma, ten), giaBan, soLuong);

				if (!check_DsCT_HoaDon(CThd)) {
					dsCt_HoaDon.add(CThd);
					spinnerModel.setValue(0);
				}
				addTable_HoaDon(dsCt_HoaDon);

			}
		} else {
			JOptionPane.showMessageDialog(this, "Hãy chọn sách bạn muốn mua. \nPlease.");
		}
	}
//

	private boolean check_SoLuong(String soLuongTable) {
		if (soLuong == 0) {
			JOptionPane.showMessageDialog(this, "Hãy chọn số lượng cần mua. \nPlease.");
			return false;
		} else if (soLuong > Integer.parseInt(soLuongTable)) {
			JOptionPane.showMessageDialog(this,
					"Hiện sách bạn muốn không đủ số lượng.\nSẽ bổ sung sớm nhất có thể. \nCảm ơn.");
			return false;
		}
		return true;
	}
//

	private boolean check_DsCT_HoaDon(CT_HoaDon cThd) {// nếu trùng thì thay doi và dừng thêm sach

		for (CT_HoaDon c : dsCt_HoaDon) {
			if (c.getSach().getMaSach().equals(cThd.getSach().getMaSach())) {

				if (c.getSoluong() != cThd.getSoluong()) {
					if (JOptionPane.showConfirmDialog(this,
							"Quyển sách này hiện đã có trong hóa đơn.\nBạn có muốn sửa lại với số lượng mới là: "
									+ soLuong + " không?",
							"Chú ý!", JOptionPane.YES_NO_OPTION) == JOptionPane.YES_NO_OPTION) {
						c.setSoluong(soLuong);

						spinnerModel.setValue(0);
						addTable_HoaDon(dsCt_HoaDon);
					}
				}else {
					JOptionPane.showMessageDialog(this, "Sản phẩm này đã có trong hóa đơn.");
				}

				return true;
			}
		}
		return false;

	}

	private void addTable_HoaDon(List<CT_HoaDon> dsCt_HoaDon) {
		DefaultTableModel dm = (DefaultTableModel) tableDonDat.getModel();
		dm.getDataVector().removeAllElements();
		double s = 0;
		double tong = 0.0;

		if (dsCt_HoaDon.size() > 0) {
			for (CT_HoaDon a : dsCt_HoaDon) {
				tong = a.getSoluong() * a.getGiaban();

				modelDonDat.addRow(new Object[] {
//						ma,ten,soLuong, giaBan, tongTien
						a.getSach().getMaSach(), a.getSach().getTenSach(), a.getSoluong(), a.getGiaban(), tong });
				s += tong;
			}
		} else {
			modelDonDat.addRow(new Object[] { "", "", "", "", "" });

		}

		txtTongTien.setText(Double.toString(s));
	}
//	

	private String phatSinh_maHD() {
		String ma_new = null;
		String ma_old = hoaDonDAO.getMaCuoi();
//		HD00001
		String ma0_2 = ma_old.substring(0, 2);
		String ma2_7 = ma_old.substring(2, 7);

		int n = Integer.parseInt(ma2_7) + 1;

		if (n < 10) {
			ma_new = ma0_2 + "0000" + n;
		} else if (n < 100) {
			ma_new = ma0_2 + "000" + n;
		} else if (n < 1000) {
			ma_new = ma0_2 + "00" + n;
		} else if (n < 10000) {
			ma_new = ma0_2 + "0" + n;
		} else if (n < 99999) {
			ma_new = ma0_2 + "" + n;
		} else {
			ma_new = "HD99999";
			System.err.println("Full ma");
			JOptionPane.showMessageDialog(this, "Bộ nhớ đã bị đầy");

		}

		return ma_new;
	}

	//
	private void getTimKiemSach() {
		List<Sach> dsSach = new ArrayList<>();
		int n = 1;

		String ma = txtMaSach.getText().trim();
		String ten = txtTenSach.getText().trim();
		String theLoai = cbbTheloai.getSelectedItem().toString();
		String nhaXB = cbbNhaXB.getSelectedItem().toString();
		String tacGia = cbbTacGia.getSelectedItem().toString();

		if (ma.equals("") && ten.equals("") && theLoai.equals("") && nhaXB.equals("") && tacGia.equals("")) {
			n = -1;
			JOptionPane.showMessageDialog(this, "Hãy nhập dữ liệu cần tìm kiếm");

			addTable_Sql(sachDAO.getDsSach());
			txtTenSach.requestFocus();
		}
//		
		if (ma.length() > 0 && n == 1) {
			Sach a = sachDAO.getSach_id(ma);
			if (a == null) {
				JOptionPane.showMessageDialog(this,
						"Mã " + ma + " không có trong danh sách.\nBạn hãy thử tìm kiếm theo nhưng thông tin khác.");
				txtMaSach.selectAll();
				txtMaSach.requestFocus();
			} else {
				DefaultTableModel dm = (DefaultTableModel) tableSach.getModel();
				dm.getDataVector().removeAllElements();

				modelSach.addRow(new Object[] { a.getMaSach(), a.getTenSach(), a.getLoai(), tacGia, nhaXB,
						a.getGiaThanh(), a.getSoLuong() });
			}

			n = -1;
		}
//		===================================================
		if (ten.length() > 0 && n == 1) {
			dsSach = sachDAO.getDsSach_Ten(dsSach, ten);
			if (dsSach.size() != 0) {
				addTable_Sql(dsSach);
			} else {
				JOptionPane.showMessageDialog(this,
						"Không tìm thấy.\nHãy kiểm tra có thể bạn đã nhập sai dữ liệu.\nTrước mỗi từ hãy viết hoa và có dấu");
				txtTenSach.selectAll();
				txtTenSach.requestFocus();
				n = -1;
				addTable_Sql(sachDAO.getDsSach());
			}
		}
//		===================================================
		if (theLoai.length() > 0 && n == 1) {
			dsSach = sachDAO.getDsSach_TheLoai(dsSach, theLoai);
			if (dsSach.size() != 0) {
				addTable_Sql(dsSach);
			} else {
				getERR_TimKiemSach(theLoai);
				n = -1;
			}
		}

//		===================================================
		if (tacGia.length() > 0 && n == 1) {
			String x = "TG" + tacGia.substring(0, 5);
			dsSach = sachDAO.getDsSach_TacGia(dsSach, x);
			if (dsSach.size() != 0) {
				addTable_Sql(dsSach);
			} else {
				getERR_TimKiemSach(tacGia);
				n = -1;
			}
		}

//		===================================================
		if (nhaXB.length() > 0 && n == 1) {
			String x = "NXB" + nhaXB.substring(0, 5);
			dsSach = sachDAO.getDsSach_NhaXB(dsSach, x);
			if (dsSach.size() != 0) {
				addTable_Sql(dsSach);
			} else {
				getERR_TimKiemSach(nhaXB);
				n = -1;
			}
		}

	}

	public void getERR_TimKiemSach(String str) { // str: thonog tin tim
		JOptionPane.showMessageDialog(this,
				"Không tìm thấy quyển sách nào phù hợp với " + str + ".\nHãy chọn một thể loại khác.");

		addTable_Sql(sachDAO.getDsSach());
	}

	private void xoaRongJtext_Sach() {
		cbbTacGia.setSelectedIndex(0);
		cbbTheloai.setSelectedIndex(0);
		cbbNhaXB.setSelectedIndex(0);

		txtTenSach.setText("");
		txtTenSach.requestFocus();
		txtMaSach.setText("");

		spinnerModel.setValue(0);

		addTable_Sql(sachDAO.getDsSach());
		addTable_HoaDon(dsCt_HoaDon);
	}

	//
	private void addCbb_Sql() {

		List<NhaXuatBan> dsNhaXuatBan = sachDAO.getDsNhaXB();

		for (NhaXuatBan a : dsNhaXuatBan) {
			String nhaXB = a.getMaNXB().substring(3, 8) + "--" + a.getTenNXB();
			cbbNhaXB.addItem(nhaXB);
		}

		List<TacGia> dsTacGia = sachDAO.getDsTacGia();

		for (TacGia a1 : dsTacGia) {
			String tacGia = a1.getMaTG().substring(2, 7) + "--" + a1.getTenTG();
			cbbTacGia.addItem(tacGia);
		}
	}

	//
	private void addTable_Sql(List<Sach> dsSach) {
		DefaultTableModel dm = (DefaultTableModel) tableSach.getModel();
		dm.getDataVector().removeAllElements();

		for (Sach a : dsSach) {
			String tacGia = a.getTacGia().getMaTG().substring(2, 7) + "--" + a.getTacGia().getTenTG();
			String nhaXB = a.getNhaXB().getMaNXB().substring(3, 8) + "--" + a.getNhaXB().getTenNXB();

//			new DecimalFormat("##.##").format(i2)
			modelSach.addRow(new Object[] {
//					"Mã sách", "Tên sách", "Thể loại", "Tác giả", "NXB", "Giá thành", "Số lượng"
					a.getMaSach(), a.getTenSach(), a.getLoai(), tacGia, nhaXB, a.getGiaThanh(), a.getSoLuong()

			});
		}
	}

	// End of variables declaration//GEN-END:variables
}
