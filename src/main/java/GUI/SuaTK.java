/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package GUI;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.List;

import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

import dao.NhanvienDAO;
import dao.TaiKhoanDAO;
import dao.impl.NhanvienImpl;
import dao.impl.TaiKhoanImpl;
import entity.NhanVien;
import entity.TaiKhoan;

/**
 *
 * @author LENOVO
 */
public class SuaTK extends JFrame implements ActionListener {

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton X;
	private javax.swing.JButton btnRefresh;
	private javax.swing.JButton btnSua;
	private javax.swing.JLabel jLabel1;
	private javax.swing.JLabel jLabel2;
	private javax.swing.JLabel jLabel3;
	private javax.swing.JLabel jLabel4;
	private javax.swing.JPanel jPanel1;
	private javax.swing.JPasswordField txtPass;
	private javax.swing.JPasswordField txtPass2;
	private javax.swing.JTextField txtUser;

    private String tk = QL.taiKhoan;

	private NhanvienDAO nhanvienDAO = new NhanvienImpl();
	private TaiKhoanDAO taiKhoanDAO = new TaiKhoanImpl();

	TaiKhoan tkNV = taiKhoanDAO.getTaiKhoan_Id(tk);
	NhanVien nv = nhanvienDAO.getNhanVien_TaiKhoan(tk);

	/**
	 * Creates new form SuaTK
	 */
	public SuaTK() {
		initComponents();
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed" desc="Generated
	// Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		jPanel1 = new javax.swing.JPanel();
		jLabel1 = new javax.swing.JLabel();
		jLabel2 = new javax.swing.JLabel();
		txtUser = new javax.swing.JTextField();
		jLabel3 = new javax.swing.JLabel();
		txtPass = new javax.swing.JPasswordField();
		btnSua = new javax.swing.JButton();
		btnRefresh = new javax.swing.JButton();
		X = new javax.swing.JButton();
		jLabel4 = new javax.swing.JLabel();
		txtPass2 = new javax.swing.JPasswordField();

		setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
		setUndecorated(true);
		jPanel1.setBackground(new java.awt.Color(204, 204, 204));
		jPanel1.setPreferredSize(new java.awt.Dimension(1361, 767));

		jLabel1.setFont(new java.awt.Font("Tahoma", 1, 24)); // NOI18N
		jLabel1.setText("Cập Nhật Thông Tin Tài Khoản");

		jLabel2.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
		jLabel2.setText("Tên Tài Khoản");

		jLabel3.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
		jLabel3.setText("Mật Khẩu Cũ");

		btnSua.setBackground(new java.awt.Color(255, 102, 0));
		btnSua.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnSua.setText("Cập Nhật");

		btnRefresh.setBackground(new java.awt.Color(255, 102, 0));
		btnRefresh.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
		btnRefresh.setText("Làm mới");

		X.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
		X.setForeground(new java.awt.Color(255, 0, 0));
		X.setText("X");
		X.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				XActionPerformed(evt);
			}
		});

		jLabel4.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
		jLabel4.setText("Mật Khẩu Mới");

		javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
		jPanel1.setLayout(jPanel1Layout);
		jPanel1Layout.setHorizontalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(jPanel1Layout.createSequentialGroup().addGroup(jPanel1Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(jPanel1Layout.createSequentialGroup().addGap(0, 162, Short.MAX_VALUE)
								.addComponent(jLabel1).addGap(98, 98, 98).addComponent(X))
						.addGroup(jPanel1Layout.createSequentialGroup().addGroup(jPanel1Layout
								.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addGroup(jPanel1Layout.createSequentialGroup().addGap(213, 213, 213)
										.addGroup(jPanel1Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
												.addComponent(jLabel2)
												.addGroup(jPanel1Layout.createSequentialGroup().addComponent(jLabel3)
														.addGap(101, 101, 101))
												.addComponent(txtUser, javax.swing.GroupLayout.PREFERRED_SIZE, 225,
														javax.swing.GroupLayout.PREFERRED_SIZE)
												.addGroup(jPanel1Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING,
																false)
														.addComponent(txtPass2,
																javax.swing.GroupLayout.Alignment.LEADING)
														.addComponent(txtPass,
																javax.swing.GroupLayout.Alignment.LEADING,
																javax.swing.GroupLayout.PREFERRED_SIZE, 225,
																javax.swing.GroupLayout.PREFERRED_SIZE))
												.addComponent(jLabel4)))
								.addGroup(jPanel1Layout.createSequentialGroup().addGap(153, 153, 153)
										.addComponent(btnRefresh, javax.swing.GroupLayout.PREFERRED_SIZE, 120,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addGap(78, 78, 78).addComponent(btnSua, javax.swing.GroupLayout.PREFERRED_SIZE,
												120, javax.swing.GroupLayout.PREFERRED_SIZE)))
								.addGap(0, 0, Short.MAX_VALUE)))
						.addContainerGap()));
		jPanel1Layout.setVerticalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(jPanel1Layout.createSequentialGroup()
						.addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
								.addComponent(X).addGroup(
										jPanel1Layout.createSequentialGroup().addGap(23, 23, 23).addComponent(jLabel1)))
						.addGap(59, 59, 59).addComponent(jLabel2)
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
						.addComponent(txtUser, javax.swing.GroupLayout.PREFERRED_SIZE, 28,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(50, 50, 50).addComponent(jLabel3)
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
						.addComponent(txtPass, javax.swing.GroupLayout.PREFERRED_SIZE, 32,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(49, 49, 49).addComponent(jLabel4)
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
						.addComponent(txtPass2, javax.swing.GroupLayout.PREFERRED_SIZE, 32,
								javax.swing.GroupLayout.PREFERRED_SIZE)
						.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 94, Short.MAX_VALUE)
						.addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
								.addComponent(btnRefresh, javax.swing.GroupLayout.PREFERRED_SIZE, 41,
										javax.swing.GroupLayout.PREFERRED_SIZE)
								.addComponent(btnSua, javax.swing.GroupLayout.PREFERRED_SIZE, 39,
										javax.swing.GroupLayout.PREFERRED_SIZE))
						.addGap(54, 54, 54)));

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
		getContentPane().setLayout(layout);
		layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(layout.createSequentialGroup()
						.addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE,
								javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
						.addGap(0, 0, Short.MAX_VALUE)));
		layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(
				jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE));

		pack();
		setLocationRelativeTo(null);
//        
		btnRefresh.addActionListener(this);
		btnSua.addActionListener(this);

		txtPass.addActionListener(this);
		txtPass2.addActionListener(this);
		txtUser.addActionListener(this);
//        
		txtUser.setText(tkNV.getTenTK());
		this.setExtendedState(JFrame.MAXIMIZED_BOTH); 
	}// </editor-fold>//GEN-END:initComponents

	private void XActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_XActionPerformed
		// TODO add your handling code here:
		new QL(QL.taiKhoan).setVisible(true);
		this.setVisible(false);
	}// GEN-LAST:event_XActionPerformed

	/**
	 * @param args the command line arguments
	 */
	public static void main(String args[]) {
		/* Set the Nimbus look and feel */
		// <editor-fold defaultstate="collapsed" desc=" Look and feel setting code
		// (optional) ">
		/*
		 * If Nimbus (introduced in Java SE 6) is not available, stay with the default
		 * look and feel. For details see
		 * http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
		 */
		try {
			for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
				if ("Nimbus".equals(info.getName())) {
					javax.swing.UIManager.setLookAndFeel(info.getClassName());
					break;
				}
			}
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(SuaTK.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (InstantiationException ex) {
			java.util.logging.Logger.getLogger(SuaTK.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(SuaTK.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (javax.swing.UnsupportedLookAndFeelException ex) {
			java.util.logging.Logger.getLogger(SuaTK.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		}
		// </editor-fold>

		/* Create and display the form */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				new SuaTK().setVisible(true);
			}
		});
	}

	// End of variables declaration//GEN-END:variables
	@Override
	public void actionPerformed(ActionEvent arg0) {
		Object o = arg0.getSource();

		if (o.equals(btnRefresh)) {
			System.err.println("btnRefresh");
			XoaRongJtext();
		} else if (o.equals(btnSua) || o.equals(txtPass) || o.equals(txtPass2)) {
			if (check_data()) {
				System.err.println("btnSua");

				if (JOptionPane.showConfirmDialog(this, "Bạn có muốn đổi lại mật khẩu cho tài khoản không?", "Cảnh báo",
						JOptionPane.YES_NO_OPTION) == JOptionPane.YES_NO_OPTION) {
					String pass = txtPass2.getText().trim();

					tkNV.setMatKhau(pass);

					taiKhoanDAO.suaTaiKhoan(tkNV);
					JOptionPane.showMessageDialog(this, "Sửa thành công.");

					new QL(tk).setVisible(true);
					this.setVisible(false);
				}
				else {
					JOptionPane.showMessageDialog(this, "Hẹn gặp lại. thank you.");
				}

			}

		}
	}

	private boolean check_data() {

		String maCheck = txtPass.getText().trim();
		String mess = "";

		if (!maCheck.equals(tkNV.getMatKhau())) {

			if (maCheck.equals("")) {
				mess = "Hãy nhập mật khẩu cũ. \nPlease.";
			} else
				mess = "Sai mật khẩu cũ.\nHãy nhập lại";

			return getMess(txtPass, mess);
		}
//		
		maCheck = txtPass2.getText().trim();
		if (!(maCheck.length() > 0
				&& maCheck.matches("^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+-=]).{6,20}$"))) {
			if (maCheck.length() == 0) {
				mess = "Hãy nhập mật khẩu mới. \nPlease";
			} else
				mess = "Mật khẩu từ 6 đến 20 kí tự, bao gồm: \nÍt nhất 1 kí tự chữ in hoa. \n"
						+ "Ít nhất 1 kí tự chữ in thường. \nÍt nhất 1 kí tự số. \nÍt nhất 1 kí tự đặc biệt(!@#$%^&*()_+-=";

			return getMess(txtPass2, mess);
		}
		if (maCheck.equals(txtPass.getText().trim())) {
			mess = "Chúng tôi thấy hai mật khẩu của bạn đang giống nhau. \nHãy nhập mật khẩu mới của bạn, hệ thống sẽ giúp bạn thay đổi mật khẩu được lưu trước đó.";
			return getMess(txtPass2, mess);
		}
		return true;
	}

//	
	private boolean getMess(JTextField txt, String mess) {
		JOptionPane.showMessageDialog(this, mess);
		txt.selectAll();
		txt.requestFocus();
		return false;
	}

	private void XoaRongJtext() {
		txtPass.setText("");
		txtPass.requestFocus();
		txtPass2.setText("");
		txtUser.setText(tkNV.getTenTK());
	}
}
